ApplicationName: "starlight-uc3"
Version: "1.0.0"

Volumes_configuration:
  - VolumeName: "uc3-pv-volume"
    VolumeType: "PersistentVolume"
    StorageClass: "standard"
    Capacity: "10Gi"
    AccessModes:
      - "ReadWriteOnce"
    HostPath:
      Path: "/mnt/ucmdata"
    ClaimName: "uc3-pv-claim"
    ClaimSpec:
      StorageClassName: "standard"
      AccessModes:
        - "ReadWriteOnce"
      Resources:
        Requests:
          Storage: "3Gi"

Security_configuration:
  - ServiceAccountName: "starlight-sa"
    ApiVersion: "v1"
    Kind: "ServiceAccount"
    Metadata:
      Name: "starlight-sa"
  - RoleBindingName: "privileged-role"
    ApiVersion: "rbac.authorization.k8s.io/v1"
    Kind: "RoleBinding"
    Metadata:
      Name: "privileged-role"
    RoleRef:
      ApiGroup: "rbac.authorization.k8s.io"
      Kind: "ClusterRole"
      Name: "system:openshift:scc:privileged"
    Subjects:
      - Kind: "ServiceAccount"
        Name: "starlight-sa"

Microservices_configuration:
  - MicroserviceName: "rabbitmq"
    Version: "3-management"
    Image: "rabbitmq:3-management"
    ID: "rabbitmq"
    ClusterAffinity: "orchestrator"
    Dependencies: []
    ResourceRequirements:
      Cpu: "0.5 vCPU"
      Memory: "1Gi"
    MicroservicesSLAs:
      ServiceAvailability: "99.9%"
      MaxResponseTime: "N/A"
      DataThroughput: "Medium"
    ReplicaCount: "1"
    Ports:
      - ContainerPort: "5672"
      - ContainerPort: "15672"
    EnvironmentVariables:
      - Name: "RABBITMQ_DEFAULT_USER"
        Value: "guest"
      - Name: "RABBITMQ_DEFAULT_PASS"
        Value: "guest"

  - MicroserviceName: "orchestrator"
    Version: "1.0"
    Image: "rayc/ucm-producer"
    ID: "orchestrator"
    ClusterAffinity: "orchestrator"
    Dependencies:
      - "rabbitmq"
    ResourceRequirements:
      Cpu: "2 vCPU"
      Memory: "4Gi"
    MicroservicesSLAs:
      ServiceAvailability: "99.9%"
      MaxResponseTime: "N/A"
      DataThroughput: "High"
    ReplicaCount: "1"
    ServiceAccountName: "starlight-sa"
    SecurityContext:
      privileged: true
    EnvironmentVariables:
      - Name: "RABBITMQ_USER"
        Value: "guest"
      - Name: "RABBITMQ_PASSWORD"
        Value: "guest"
      - Name: "RABBITMQ_HOST"
        Value: "rabbitmq"
      - Name: "RABBITMQ_PORT"
        Value: "5672"
      - Name: "INPUT_DIR"
        Value: "/starlight/data/input"
      - Name: "OUTPUT_DIR"
        Value: "/starlight/data/output"
      - Name: "BATCH_SIZE"
        Value: 5
    Ports:
      - ContainerPort: "5672"
    Volumes:
      - Name: "uc3-pv-storage"
        VolumeSource:
          PersistentVolumeClaim:
            ClaimName: "uc3-pv-claim"
    VolumeMounts:
      - Name: "uc3-pv-storage"
        MountPath: "/starlight/"
    InitContainers:
      - Name: "init"
        Image: "busybox:1.28"
        securityContext:
          privileged: true
        volumeMounts:
          - mountPath: "/starlight/"
            name: "uc3-pv-storage"
        Command:
          - sh
          - -c
          - |
            if [ ! -d /starlight/data ]; then mkdir -p /starlight/data; fi;
            if [ ! -d /starlight/runtime ]; then mkdir -p /starlight/runtime; fi;
            if [ ! -d /starlight/runtime/infiles ]; then mkdir -p /starlight/runtime/infiles; fi;
            if [ ! -d /starlight/runtime/input ]; then mkdir -p /starlight/runtime/input; fi;
            if [ ! -d /starlight/data/input ]; then mkdir -p /starlight/data/input; fi;
            if [ ! -d /starlight/data/output ]; then mkdir -p /starlight/data/output; fi;
            if [ ! -d /starlight/data/input/processed ]; then mkdir -p /starlight/data/input/processed; fi;
            if [ ! -f /starlight/runtime/processlist.txt ]; then touch /starlight/runtime/processlist.txt; fi;

  - MicroserviceName: "data-connector"
    Version: "1.0"
    Image: "quay.io/bcapper30/ionos-s3-consumer-env"
    ID: "data-connector"
    ClusterAffinity: "orchestrator"
    Dependencies:
      - "orchestrator"
    ResourceRequirements:
      Cpu: "1 vCPU"
      Memory: "2Gi"
    MicroservicesSLAs:
      ServiceAvailability: "99.9%"
      MaxResponseTime: "N/A"
      DataThroughput: "Medium"
    ReplicaCount: "1"
    EnvironmentVariables:
      - Name: "JAVA_TOOL_OPTIONS"
        Value: "-Dedc.fs.config=/app/resources/config.properties"
      - Name: "EDC_PARTICIPANT_ID"
        Value: "consumer"
      - Name: "WEB_HTTP_PORT"
        Value: "9191"
      - Name: "WEB_HTTP_PATH"
        Value: "/api"
      - Name: "WEB_HTTP_MANAGEMENT_PORT"
        Value: "9192"
      - Name: "WEB_HTTP_MANAGEMENT_PATH"
        Value: "/management"
      - Name: "WEB_HTTP_PROTOCOL_PORT"
        Value: "9292"
      - Name: "WEB_HTTP_PROTOCOL_PATH"
        Value: "/protocol"
      - Name: "WEB_HTTP_CONTROL_PORT"
        Value: "9293"
      - Name: "WEB_HTTP_CONTROL_PATH"
        Value: "/control"
      - Name: "WEB_HTTP_PUBLIC_PORT"
        Value: "9393"
      - Name: "WEB_HTTP_PUBLIC_PATH"
        Value: "/public"
      - Name: "EDC_DSP_CALLBACK_ADDRESS"
        Value: "http://consumer:9292/protocol"
      - Name: "EDC_DATAPLANE_TOKEN_VALIDATION_ENDPOINT"
        Value: "http://localhost:9293/control/token"
      - Name: "EDC_DATAPLANE_API_PUBLIC_BASEURL"
        Value: "http://localhost:9393/public"
      - Name: "EDC_DSP_HTTP_ENABLED"
        Value: "true"
      - Name: "EDC_API_AUTH_KEY"
        Value: "password"
      - Name: "EDC_TRANSFER_PROXY_TOKEN_SIGNER_PRIVATEKEY_ALIAS"
        Value: "edc.connector.private.key"
      - Name: "EDC_TRANSFER_PROXY_TOKEN_VERIFIER_PUBLICKEY_ALIAS"
        Value: "edc.connector.public.key"
      - Name: "EDC_VAULT_HASHICORP_URL"
        Value: "http://vault:8200"
      - Name: "EDC_VAULT_HASHICORP_TOKEN"
        Value: "test-token"
      - Name: "EDC_VAULT_HASHICORP_TIMEOUT_SECONDS"
        Value: "30"
      - Name: "EDC_IONOS_ACCESS_KEY"
        Value: "EEAAAAHuEn6LkwZJGpUAikGoJHyOrAra4yXAV1WVXpvA8XU0HAAAAAEB7vvNAAAAAAHu-80YrfBIAbZ4Ef4idjOF9BTQ"
      - Name: "EDC_IONOS_SECRET_KEY"
        Value: "D3c2ApVsGGa7Wm1+pmfDwJddoPxhY3qSwU1U2EUUyKJRE07H3MjR3nwwaxim7mhY"
      - Name: "EDC_IONOS_ENDPOINT_REGION"
        Value: "eu-central-2"
      - Name: "EDC_IONOS_TOKEN"
        Value: "6ca9b102-5430-4473-b349-4c0d904d7e56"
    Ports:
      - ContainerPort: 9191
      - ContainerPort: 9192
      - ContainerPort: 9292
      - ContainerPort: 9293
      - ContainerPort: 9393

  - MicroserviceName: "starlight"
    Version: "1.0"
    Image: "rayc/ucm-processor"
    ID: "starlight"
    ClusterAffinity: "processor"
    Dependencies:
      - "eventreceiver"
    ResourceRequirements:
      Cpu: "4 vCPU"
      Memory: "8Gi"
    MicroservicesSLAs:
      ServiceAvailability: "99.9%"
      MaxResponseTime: "N/A"
      DataThroughput: "High"
    ReplicaCount: "1"
    ServiceAccountName: "starlight-sa"
    SecurityContext:
      privileged: true
    WorkingDirectory: "/docker/starlight/STARLIGHTv04"
    Command:
      - ./bash_script2.sh
    Volumes:
      - Name: "uc3-pv-storage"
        VolumeSource:
          PersistentVolumeClaim:
            ClaimName: "uc3-pv-claim"
    VolumeMounts:
      - Name: "uc3-pv-storage"
        MountPath: "/starlight/"
    Ports:
      - ContainerPort: 8080

  - MicroserviceName: "eventreceiver"
    Version: "1.0"
    Image: "rayc/ucm-receiver"
    ID: "eventreceiver"
    ClusterAffinity: "processor"
    Dependencies:
      - "rabbitmq"
    ResourceRequirements:
      Cpu: "1 vCPU"
      Memory: "2Gi"
    MicroservicesSLAs:
      ServiceAvailability: "99.9%"
      MaxResponseTime: "N/A"
      DataThroughput: "High"
    ReplicaCount: "1"
    EnvironmentVariables:
      - Name: "RABBITMQ_USER"
        Value: "guest"
      - Name: "RABBITMQ_PASSWORD"
        Value: "guest"
    Volumes:
      - Name: "uc3-pv-storage"
        VolumeSource:
          PersistentVolumeClaim:
            ClaimName: "uc3-pv-claim"
    VolumeMounts:
      - Name: "uc3-pv-storage"
        MountPath: "/starlight/"

Networking_graph:
  - Source: "orchestrator"
    Destination: "rabbitmq"
    Protocol: "TCP"
    Port: "5672"
  - Source: "data-connector"
    Destination: "orchestrator"
    Protocol: "HTTP"
    Port: "9192"
  - Source: "eventreceiver"
    Destination: "rabbitmq"
    Protocol: "TCP"
    Port: "5672"
  - Source: "eventreceiver"
    Destination: "starlight"
    Protocol: "HTTP"
    Port: "8080"

Global_SLA:
  ServiceAvailability: "99.9%"
  MaxLatency: "500 ms"
  MaxResponseTime: "N/A"
  DataThroughput: "High"
